<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reserva Audi Q5</title>
</head>
<body>

  <form
    id="reservaForm"
    method="POST"
    action="https://script.google.com/macros/s/AKfycbwpl3AtSsBCVE_jzC9CfGVhWLV8bfTGHqkI7hmrUuQz-jTBMsaQ3rpALPX2_dkBnYiiGg/exec"
    style="max-width:400px;margin:40px auto;padding:20px;border:1px solid #ccc;border-radius:10px;"
  >
    <h3>Reserva tu Audi Q5</h3>

    <label>Nombre:</label><br>
    <input type="text" name="nombre" required style="width:100%;margin-bottom:10px;">

    <label>Correo:</label><br>
    <input type="email" name="email" required style="width:100%;margin-bottom:10px;">

    <label>Fecha Inicio:</label><br>
    <input type="date" name="fechaInicio" required style="width:100%;margin-bottom:10px;">

    <label>Fecha Fin:</label><br>
    <input type="date" name="fechaFin" required style="width:100%;margin-bottom:10px;">

    <!-- Campos ocultos para mandar el cálculo al servidor -->
    <input type="hidden" id="dias" name="dias">
    <input type="hidden" id="total" name="total">

    <!-- Texto para mostrarle al usuario el detalle del precio -->
    <p id="resultadoPrecio" style="font-weight:bold;margin-top:10px;text-align:center;"></p>

    <button type="submit" style="width:100%;padding:10px;background:#635bff;color:white;border:none;border-radius:5px;cursor:pointer;">
      Reservar y pagar
    </button>
  </form>

<script>
  const form = document.getElementById("reservaForm");
  const inicioInput = document.querySelector('input[name="fechaInicio"]');
  const finInput   = document.querySelector('input[name="fechaFin"]');
  const diasInput  = document.getElementById("dias");
  const totalInput = document.getElementById("total");
  const resultado  = document.getElementById("resultadoPrecio");

  // Precios por día
  const PRECIO_SEMANA = 100;  // lunes–viernes
  const PRECIO_FINDE  = 135;  // sábado–domingo

  function calcularPrecio() {
    const fechaInicio = inicioInput.value;
    const fechaFin    = finInput.value;

    if (!fechaInicio || !fechaFin) {
      resultado.textContent = "";
      diasInput.value  = "";
      totalInput.value = "";
      return false;
    }

    const inicio = new Date(fechaInicio);
    const fin    = new Date(fechaFin);

    const diffTime = fin - inicio;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays <= 0) {
      resultado.textContent = "La fecha de entrega debe ser después de la fecha de recogida.";
      diasInput.value  = "";
      totalInput.value = "";
      return false;
    }

    let diasSemana = 0;
    let diasFinde  = 0;

    const cursor = new Date(inicio);
    while (cursor < fin) {
      const diaSemana = cursor.getDay(); // 0 domingo, 6 sábado

      if (diaSemana === 0 || diaSemana === 6) {
        diasFinde++;
      } else {
        diasSemana++;
      }

      cursor.setDate(cursor.getDate() + 1);
    }

    const total = (diasSemana * PRECIO_SEMANA) + (diasFinde * PRECIO_FINDE);

    resultado.innerHTML = `
      Has seleccionado <strong>${diffDays}</strong> día(s):<br>
      ${diasSemana} día(s) entre semana a CA$ ${PRECIO_SEMANA} +
      ${diasFinde} día(s) de fin de semana a CA$ ${PRECIO_FINDE}.<br>
      <strong>Total estimado: CA$ ${total}</strong>.
    `;

    diasInput.value  = diffDays;
    totalInput.value = total;

    return true;
  }

  inicioInput.addEventListener("change", calcularPrecio);
  finInput.addEventListener("change", calcularPrecio);

  form.addEventListener("submit", function (e) {
    const ok = calcularPrecio();
    if (!ok) {
      e.preventDefault();
      alert("Revisa las fechas antes de continuar.");
    }
    // Si ok === true, el navegador hace el POST normal a la Web App
  });
</script>

</body>
</html>
