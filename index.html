<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reserva Audi Q5</title>
</head>
<body>

  <form
    id="reservaForm"
    method="POST"
    action="https://script.google.com/macros/s/AKfycbzpdsZOMzcgPC6mhalA6SU49amApvquiwAXmkMzIOa10YH3J63y6w2c7BuHhbZHXoPf/exec"
    style="max-width:400px;margin:40px auto;padding:20px;border:1px solid #ccc;border-radius:10px;"
  >
    <h3>Reserva tu Audi Q5</h3>

    <label>Nombre:</label><br>
    <input type="text" name="nombre" required style="width:100%;margin-bottom:10px;">

    <label>Correo:</label><br>
    <input type="email" name="email" required style="width:100%;margin-bottom:10px;">

    <label>Fecha Inicio:</label><br>
    <input type="date" name="fechaInicio" required style="width:100%;margin-bottom:10px;">

    <label>Fecha Fin:</label><br>
    <input type="date" name="fechaFin" required style="width:100%;margin-bottom:10px;">

    <!-- Campos ocultos para enviar a la Web App -->
    <input type="hidden" id="dias" name="dias">
    <input type="hidden" id="total" name="total">

    <!-- Mensaje para mostrar al cliente -->
    <p id="resultadoPrecio" style="font-weight:bold;margin-top:10px;text-align:center;"></p>

    <button type="submit" style="width:100%;padding:10px;background:#635bff;color:white;border:none;border-radius:5px;cursor:pointer;">
      Reservar y pagar
    </button>
  </form>

<script>
  const form = document.getElementById("reservaForm");
  const inicioInput = document.querySelector('input[name="fechaInicio"]');
  const finInput   = document.querySelector('input[name="fechaFin"]');
  const diasInput  = document.getElementById("dias");
  const totalInput = document.getElementById("total");
  const resultado  = document.getElementById("resultadoPrecio");

  // Precios por día
  const PRECIO_SEMANA   = 100; // lunes a viernes
  const PRECIO_FINDE    = 135; // sábado y domingo

  function calcularPrecio() {
    const fechaInicio = inicioInput.value;
    const fechaFin    = finInput.value;

    if (!fechaInicio || !fechaFin) {
      if (resultado) resultado.textContent = "";
      diasInput.value  = "";
      totalInput.value = "";
      return false;
    }

    const inicio = new Date(fechaInicio);
    const fin    = new Date(fechaFin);

    // diferencia total en días (sin incluir el día de devolución)
    const diffTime = fin - inicio;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays <= 0) {
      if (resultado) {
        resultado.textContent = "La fecha de entrega debe ser después de la fecha de recogida.";
      }
      diasInput.value  = "";
      totalInput.value = "";
      return false;
    }

    // Contar días entre semana y fines de semana
    let diasSemana = 0;
    let diasFinde  = 0;

    // Clonamos la fecha de inicio para iterar
    const cursor = new Date(inicio);

    // Recorremos desde inicio (incluido) hasta justo antes de fin
    while (cursor < fin) {
      const diaSemana = cursor.getDay(); // 0 = domingo, 6 = sábado

      if (diaSemana === 0 || diaSemana === 6) {
        diasFinde++;
      } else {
        diasSemana++;
      }

      cursor.setDate(cursor.getDate() + 1);
    }

    const total = (diasSemana * PRECIO_SEMANA) + (diasFinde * PRECIO_FINDE);

    // Mostrar mensaje al cliente
    if (resultado) {
      resultado.innerHTML = `
        Has seleccionado <strong>${diffDays}</strong> día(s):<br>
        ${diasSemana} día(s) entre semana a CA$ ${PRECIO_SEMANA} +
        ${diasFinde} día(s) de fin de semana a CA$ ${PRECIO_FINDE}.<br>
        <strong>Total estimado: CA$ ${total}</strong>.
      `;
    }

    // Guardar valores en campos ocultos
    diasInput.value  = diffDays;
    totalInput.value = total;

    return true;
  }

  // Recalcular cuando cambian las fechas
  if (inicioInput) inicioInput.addEventListener("change", calcularPrecio);
  if (finInput)   finInput.addEventListener("change", calcularPrecio);

  if (form) {
    form.addEventListener("submit", function (e) {
      const ok = calcularPrecio();
      if (!ok) {
        e.preventDefault();
        alert("Revisa las fechas de inicio y fin antes de continuar.");
      }
      // Si ok === true, dejamos que el navegador haga el POST normal a la Web App
    });
  }
</script>

</body>
</html>
